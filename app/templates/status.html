{% extends "base.html" %}
{% block content %}
  <div class="row">
    <div class="panel panel-primary col-sm-7">
      <div class="panel-heading">
        <h2 class="panel-title">Board to Play: {{ BOARD_LIST[game.board_to_play] }}</h2>
      </div>
      <div class="panel-body">
        <ul class="list-group">
          <li class="list-group-item">
              <h4>
                  Intake Program
                <span class="label label-info ">{{ intake|length }}</span>
                <a href="{{ url_for('play_intake', game_id=game.id) }}">
                    <button type="button" class="btn btn-xs btn-success btn pull-right">Play</button>
                </a>
              </h4>
          </li>
          <li class="list-group-item">
              <h4>
                  Emergency Housing
                  <span class="label label-info ">{{ emergency|length }}</span>
                  <a href="{{ url_for('play_emergency', game_id=game.id) }}">
                    <button type="button" class="btn btn-xs btn-success btn pull-right">Play</button>
                  </a>
              </h4>
          </li>
          <li class="list-group-item">
            <h4>
              Rapid Rehousing
              <span class="label label-info ">{{ rapid|length }}</span>
              <a href="{{ url_for('play_rapid', game_id=game.id) }}">
                <button type="button" class="btn btn-xs btn-success btn pull-right">Play</button>
              </a>
            </h4>
          </li>
          <li class="list-group-item">
            <h4>
              Outreach Program
              <span class="label label-info ">{{ outreach|length }}</span>
              <a href="{{ url_for('play_outreach', game_id=game.id) }}">
                <button type="button" class="btn btn-xs btn-success btn pull-right">Play</button>
              </a>
            </h4>
          </li>
          <li class="list-group-item">
            <h4>
              Transitional Housing
              <span class="label label-info ">{{ transitional|length }}</span>
              <a href="{{ url_for('play_transitional', game_id=game.id) }}">
                <button type="button" class="btn btn-xs btn-success btn pull-right">Play</button>
              </a>
            </h4>
          </li>
          <li class="list-group-item">
            <h4>
              Permanent Supportive Housing
              <span class="label label-info ">{{ permanent|length }}</span>
              <a href="{{ url_for('play_permanent', game_id=game.id) }}">
                <button type="button" class="btn btn-xs btn-success btn pull-right">Play</button>
              </a>
            </h4>
          </li>
        </ul>
      </div><!-- ./panel body -->
      {% if game.round_count > 1 %}
      <div class="panel-heading">
        <h2 class="panel-title">People In Programs</h2>
      </div>
      <div class="panel-body">
        <!-- chart canvas element  -->
        <canvas id="program_chart" width="400" height="200"></canvas>
      </div>
      <div class="panel-heading">
        <h2 class="panel-title">People After Programs</h2>
      </div>
      <div class="panel-body">
        <!-- chart canvas element  -->
        <canvas id="outside_chart" width="400" height="200"></canvas>
      </div>
      {% endif %}
    </div><!-- ./panel left -->
    <div class="col-sm-1">
    </div><!-- ./panel center -->
    <div class="col-sm-4">
      <div class="panel panel-info">
        <div class="panel-heading">
            <h2 class="panel-title">Most Recent Moves</h2>
        </div>
        <div class="panel-body">
            {% if last_moves %}
            <ul class="list-group">
                {% for move in last_moves %}
                <li class="list-group-item">{{ move }}</li>
                {% endfor %}
            </ul>
            {% else %}
            <p>No recent moves</p>
            {% endif %}
            {% if game.round_count == 6 %}
            <a href="{{ url_for('system_event', game_id=game.id) }}">
                <button class="btn btn-success">Final Score</button>
            </a>
            {% endif %}
        </div>
      </div><!-- ./div panel Moves -->
      <div class="panel panel-warning">
        <div class="panel-heading">
            <h2 class="panel-title">Stats</h2>
        </div>
        <div class="panel-body">
        <ul class="list-group">
          <li class="list-group-item">
              People in Market Housing
              <span class="label label-info ">{{ market|length }}</span>
          </li>
          <li class="list-group-item">
              Unsheltered People
              <span class="label label-info ">{{ unsheltered|length }}</span>
          </li>
          <li class="list-group-item">
              Emergency Housing Per Round
              <span class="label label-info ">{{ e_counts }}</span>
          </li>
          <li class="list-group-item">
              Transitional Housing Per Round
              <span class="label label-info ">{{ t_counts }}</span>
          </li>
        </ul>
      </div><!-- ./div panel Bins -->
    </div><!-- ./panel right -->
  </div><!-- ./row -->

<script>
  // program_chart data
  var progData = {
  labels : [0, 1, 2, 3, 4, 5],
  datasets : [{
        data: [{% for count in e_counts %}
                  {{count}},
                {% endfor %}],
        label: "Emergency",
        fillColor: "rgba(255,255,255,.2)",
        strokeColor: "rgba(151,187,205,1)",
        pointColor: "rgba(151,187,205,1)",
      },{ 
        data: [{% for count in r_counts %}
                  {{count}},
                {% endfor %}],
        label: "Rapid",
        fillColor: "rgba(255,255,255,.2)",
        strokeColor: "rgba(255,51,51,1)",
        pointColor: "rgba(255,51,51,1)",
      },{ 
        data: [{% for count in t_counts %}
                  {{count}},
                {% endfor %}],
        label: "Transitional",
        fillColor: "rgba(255,255,255,.2)",
        strokeColor: "rgba(51,204,51,1)",
        pointColor: "rgba(51,204,51,1)",
      },{ 
        data: [{% for count in p_counts %}
                  {{count}},
                {% endfor %}],
        label: "Permanent",
        fillColor: "rgba(255,255,255,.2)",
        strokeColor: "rgba(204,0,102,1)",
        pointColor: "rgba(204,0,102,1)",
      }
    ]
  }
  // Set line-chart-related defaults
  Chart.defaults.global.responsive = false;
  Chart.defaults.global.scaleLineColor = "black";
  Chart.defaults.global.scaleFontSize = 16;
  // get program_chart canvas
  var prog_chart = document.getElementById("program_chart").getContext("2d");
  steps = 25
  max = 25
  // draw program_chart
  new Chart(prog_chart).Line(progData, {
      display: true,
      scaleShowGridLines : false,
      barShowStroke : true,
      bezierCurve: false,
  });

  // outside_chart data
  var outsideData = {
  labels : [0, 1, 2, 3, 4, 5],
  datasets : [{
        data: [{% for count in m_counts %}
                  {{count}},
                {% endfor %}],
        label: "Market",
        fillColor: "rgba(255,255,255,.2)",
        strokeColor: "rgba(151,187,205,1)",
        pointColor: "rgba(151,187,205,1)",
      },{ 
        data: [{% for count in u_counts %}
                  {{count}},
                {% endfor %}],
        label: "Unsheltered",
        fillColor: "rgba(255,255,255,.2)",
        strokeColor: "rgba(255,51,51,1)",
        pointColor: "rgba(255,51,51,1)",
      }
    ]
  }
  // Set line-chart-related defaults
  Chart.defaults.global.responsive = false;
  Chart.defaults.global.scaleLineColor = "black";
  Chart.defaults.global.scaleFontSize = 16;
  // get program_chart canvas
  var prog_chart = document.getElementById("outside_chart").getContext("2d");
  steps = 200
  max = 200
  // draw program_chart
  new Chart(prog_chart).Line(outsideData, {
      display: true,
      scaleShowGridLines : false,
      barShowStroke : true,
      bezierCurve: false,
  });
</script>
{% endblock %}
